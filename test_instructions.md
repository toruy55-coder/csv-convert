# CSV結合・変換ツール テスト実行手順書

## 準備

1. ブラウザで `index.html` を開く
2. 以下のテストデータファイルが同じディレクトリにあることを確認：
   - `test_a.csv`
   - `test_b.csv`
   - `test_single.csv`

---

## TC-01: Left Join（基本動作）

### 手順
1. **定義モード** タブを開く
2. CSV A に `test_a.csv` をアップロード
3. CSV B に `test_b.csv` をアップロード
4. 結合設定：
   - A側の結合キー: `社員ID`
   - B側の結合キー: `社員ID`
   - 結合方法: `Aを基準にBを補完`
5. 出力カラム設定: すべて選択のままにする
6. データ検証設定: すべてオフにする
7. 設定名に「テスト設定01」と入力
8. 「設定を保存」をクリック
9. **実行モード** タブを開く
10. 保存済み設定で「テスト設定01」を選択
11. CSV A に `test_a.csv` をアップロード
12. CSV B に `test_b.csv` をアップロード
13. 「▶ 変換を実行」をクリック

### 期待値
- 出力行数: 10行（Aの全行）
- 社員ID=003 と 007 の売上金額・達成率・評価欄は空欄
- 社員ID=005 は重複しているため2行出力される
- 空白の社員IDの行も出力される

### 確認ポイント
- [ ] 出力行数が10行である
- [ ] 先頭20行のプレビューで003と007の売上欄が空欄である
- [ ] CSVダウンロードができる

---

## TC-02: Inner Join

### 手順
1. **定義モード** タブで「テスト設定01」を読込
2. 結合方法を `両方に一致する行だけ出力` に変更
3. 設定名を「テスト設定02」に変更
4. 「設定を保存」をクリック
5. **実行モード** タブを開く
6. 保存済み設定で「テスト設定02」を選択
7. CSV A に `test_a.csv` をアップロード
8. CSV B に `test_b.csv` をアップロード
9. 「▶ 変換を実行」をクリック

### 期待値
- 出力行数: 7行（003・007・空白行・009・010を除く）
- 両方に存在する社員IDのみ出力される

### 確認ポイント
- [ ] 出力行数が7行である
- [ ] 003と007が含まれていない

---

## TC-03: Outer Join

### 手順
1. **定義モード** タブで「テスト設定01」を読込
2. 結合方法を `すべての行を出力（全結合）` に変更
3. 設定名を「テスト設定03」に変更
4. 「設定を保存」をクリック
5. **実行モード** タブを開く
6. 保存済み設定で「テスト設定03」を選択
7. CSV A に `test_a.csv` をアップロード
8. CSV B に `test_b.csv` をアップロード
9. 「▶ 変換を実行」をクリック

### 期待値
- 出力行数: 11行（Aの10行 + Bにのみ存在する009）
- 009の社員IDの行で、氏名・部署・入社年度欄は空欄

### 確認ポイント
- [ ] 出力行数が11行である
- [ ] 009の行が含まれている
- [ ] 009の行でA側のカラムが空欄である

---

## TC-04: 変換ルール

### 手順
1. **定義モード** タブで「テスト設定01」を読込
2. フォーマット変換ルールで「+ ルールを追加」を3回クリック
3. ルール1:
   - カラム: `評価`
   - 変換前: `1`
   - 変換後: `優`
4. ルール2:
   - カラム: `評価`
   - 変換前: `2`
   - 変換後: `良`
5. ルール3:
   - カラム: `評価`
   - 変換前: `3`
   - 変換後: `可`
6. 設定名を「テスト設定04」に変更
7. 「設定を保存」をクリック
8. **実行モード** タブを開く
9. 保存済み設定で「テスト設定04」を選択
10. CSV A に `test_a.csv` をアップロード
11. CSV B に `test_b.csv` をアップロード
12. 「▶ 変換を実行」をクリック

### 期待値
- 出力行数: 10行
- 評価カラムが数値から日本語に変換されている
  - 1 → 優
  - 2 → 良
  - 3 → 可

### 確認ポイント
- [ ] 評価カラムが「優」「良」「可」の日本語になっている

---

## TC-05: 重複行除去

### 手順
1. **定義モード** タブで「テスト設定01」を読込
2. データ検証設定で「重複行除去」にチェック
3. 設定名を「テスト設定05」に変更
4. 「設定を保存」をクリック
5. **実行モード** タブを開く
6. 保存済み設定で「テスト設定05」を選択
7. CSV A に `test_a.csv` をアップロード
8. CSV B に `test_b.csv` をアップロード
9. 「▶ 変換を実行」をクリック

### 期待値
- 出力行数: 9行（005の重複行が1行に集約）
- 結果サマリーに「重複除去: 1行」と表示される

### 確認ポイント
- [ ] 出力行数が9行である
- [ ] 結果サマリーに「重複除去: 1行」と表示されている

---

## TC-06: データ検証（空白キー）

### 手順
1. **定義モード** タブで「テスト設定01」を読込
2. データ検証設定で「空白キーチェック」にチェック
3. 設定名を「テスト設定06」に変更
4. 「設定を保存」をクリック
5. **実行モード** タブを開く
6. 保存済み設定で「テスト設定06」を選択
7. CSV A に `test_a.csv` をアップロード
8. CSV B に `test_b.csv` をアップロード
9. 「▶ 変換を実行」をクリック

### 期待値
- 警告モーダルが表示される
- 「CSV Aの結合キーに空白が1件あります」という警告が表示される
- 「このまま実行」をクリックすると処理が続行される
- 「キャンセル」をクリックすると処理が中止される

### 確認ポイント
- [ ] 警告モーダルが表示される
- [ ] 「CSV Aの結合キーに空白が1件あります」と表示される
- [ ] 「このまま実行」で処理が続行できる

---

## TC-07: 列整形モード

### 手順
1. **列整形モード** タブを開く
2. `test_single.csv` をアップロード
3. 列設定で以下を実行：
   - 「備考」のチェックボックスをオフにする（除外）
   - 「単価」をドラッグして「数量」の下に移動（入れ替え）
   - 「合計」のリネーム欄に「売上合計」と入力
4. 設定名に「列整形テスト」と入力
5. 「設定を保存」をクリック
6. 「整形して出力」をクリック

### 期待値
- 出力カラム数: 7列（備考を除外）
- 出力行数: 15行
- 列順: ID, 日付, 商品名, カテゴリ, 数量, 単価, 売上合計
- ファイル名: `test_single_整形済み_YYYYMMDDHHMMSS.csv`

### 確認ポイント
- [ ] ダウンロードされたCSVのカラム数が7列である
- [ ] 列順が指定通りである（数量と単価が入れ替わっている）
- [ ] 「合計」が「売上合計」にリネームされている
- [ ] 「備考」列が含まれていない

---

## TC-08: 設定の保存と再利用

### 手順
1. **定義モード** タブで「テスト設定01」を削除（もし存在すれば）
2. TC-01の手順で「テスト設定01」を新規作成
3. ページをリロード（F5）
4. **定義モード** タブの保存済み設定から「テスト設定01」を読込
5. **実行モード** タブで「テスト設定01」を選択して実行

### 期待値
- ページリロード後も設定が保持されている
- 読み込んだ設定が正しく反映されている
- 同じ条件で実行できる

### 確認ポイント
- [ ] ページリロード後も設定が存在する
- [ ] 読み込んだ設定でTC-01と同じ結果が得られる

---

## TC-09: エクスポート・インポート

### 手順
1. **定義モード** タブで「テスト設定01」を読込
2. 設定名を確認
3. 「設定をエクスポート」をクリック
4. JSONファイルがダウンロードされることを確認
5. 保存済み設定から「テスト設定01」を削除
6. 「設定をインポート」をクリック
7. ダウンロードしたJSONファイルを選択
8. インポート成功のメッセージを確認
9. 保存済み設定に「テスト設定01」が復元されていることを確認
10. 「テスト設定01」を読込

### 期待値
- JSONファイルが正しくエクスポートされる
- インポートで設定が復元される
- 復元された設定で同じ処理ができる

### 確認ポイント
- [ ] エクスポートでJSONファイルがダウンロードされる
- [ ] インポートで設定が復元される
- [ ] 復元された設定が正しく動作する

---

## 追加確認項目

### 実行ログタブ
1. **実行ログ** タブを開く
2. テストケース実行履歴が記録されていることを確認
3. 各ログの詳細を展開表示できることを確認

### 確認ポイント
- [ ] 実行履歴が新しい順に表示される
- [ ] 日時・設定名・ファイル名・出力行数が記録されている
- [ ] 警告があった実行には「警告あり」バッジが表示される

---

## テスト完了後

すべてのテストケースを実行したら、`test_report.md` に結果を記録してください。
